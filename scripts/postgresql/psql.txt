//Create database
CREATE DATABASE polaigo_test;

//Create bills_and_resolutions table
CREATE TABLE IF NOT EXISTS bills_and_resolutions(
    type VARCHAR(7),
    number SMALLINT,
    title TEXT NOT NULL,
    status TEXT,
    mostRecentVote DATE,
    mostRecentCREC TEXT,
    chamber VARCHAR(6) NOT NULL,
    PRIMARY KEY( type, number )
);

//DEPRECATED Create congressional_legislators_active table
    //Replaced with representatives_of_hr_active and senators_of_senate_active tables
CREATE TABLE IF NOT EXISTS congressional_legislators_active(
    bioGuideId VARCHAR(7) PRIMARY KEY,
    chamber VARCHAR(6) NOT NULL,
    initialTerm SMALLINT,
    previousLegislativePositions JSON,
    state CHAR(2) NOT NULL,
    party CHAR NOT NULL,
    firstName VARCHAR NOT NULL,
    lastName VARCHAR NOT NULL,
    middleName VARCHAR,
    district SMALLINT
);

// Create representatives_of_hr_active table
CREATE TABLE IF NOT EXISTS representatives_of_hr_active(
    bioGuideId VARCHAR(7) PRIMARY KEY,
    priorCongress SMALLINT,
    previousLegislativePositions JSON,
    state CHAR(2) NOT NULL,
    party CHAR NOT NULL,
    firstName VARCHAR NOT NULL,
    lastName VARCHAR NOT NULL,
    middleName VARCHAR,
    district SMALLINT NOT NULL,
    dateOfLastUpdate DATE NOT NULL
);

// Create senators_of_senate_active table
CREATE TABLE IF NOT EXISTS senators_of_senate_active(
    bioGuideId VARCHAR(7) PRIMARY KEY,
    priorCongress SMALLINT,
    previousLegislativePositions JSON,
    state CHAR(2) NOT NULL,
    party CHAR NOT NULL,
    firstName VARCHAR NOT NULL,
    lastName VARCHAR NOT NULL,
    middleName VARCHAR,
    dateOfLastUpdate DATE 
);

//Create votes table
CREATE TABLE IF NOT EXISTS votes(
    type VARCHAR(7) NOT NULL,
    number SMALLINT NOT NULL,
    bioGuideId VARCHAR(15),
    voteDate DATE,
    CRECOfVote TEXT,
    congressTerm SMALLINT NOT NULL,
    rollCall SMALLINT NOT NULL,
    PRIMARY KEY( type, number )
);

//Create party_codes table
CREATE TABLE IF NOT EXISTS party_codes(
    partyCode CHAR PRIMARY KEY,
    partyFullName VARCHAR UNIQUE
);

//Insert into party_codes table
INSERT INTO party_codes (partyCode, partyFullName) VALUES
('D', 'Democratic'),
('R', 'Republican'),
('I', 'Independent');

//Create state_codes table
CREATE TABLE IF NOT EXISTS state_codes(
    twoLetterCode CHAR(2) PRIMARY KEY,
    stateName TEXT NOT NULL
);

//Insert into state_codes table
INSERT INTO state_codes (twoLetterCode, stateName) VALUES 
('AL', 'Alabama'),
('AK', 'Alaska'),
('AZ', 'Arizona'),
('AR', 'Arkansas'),
('CA', 'California'),
('CO', 'Colorado'),
('CT', 'Connecticut'),
('DE', 'Delaware'),
('FL', 'Florida'),
('GA', 'Georgia'),
('HI', 'Hawaii'),
('ID', 'Idaho'),
('IL', 'Illinois'),
('IN', 'Indiana'),
('IA', 'Iowa'),
('KS', 'Kansas'),
('KY', 'Kentucky'),
('LA', 'Louisiana'),
('ME', 'Maine'),
('MD', 'Maryland'),
('MA', 'Massachusetts'),
('MI', 'Michigan'),
('MN', 'Minnesota'),
('MS', 'Mississippi'),
('MO', 'Missouri'),
('MT', 'Montana'),
('NE', 'Nebraska'),
('NV', 'Nevada'),
('NH', 'New Hampshire'),
('NJ', 'New Jersey'),
('NM', 'New Mexico'),
('NY', 'New York'),
('NC', 'North Carolina'),
('ND', 'North Dakota'),
('OH', 'Ohio'),
('OK', 'Oklahoma'),
('OR', 'Oregon'),
('PA', 'Pennsylvania'),
('RI', 'Rhode Island'),
('SC', 'South Carolina'),
('SD', 'South Dakota'),
('TN', 'Tennessee'),
('TX', 'Texas'),
('UT', 'Utah'),
('VT', 'Vermont'),
('VA', 'Virginia'),
('WA', 'Washington'),
('WV', 'West Virginia'),
('WI', 'Wisconsin'),
('WY', 'Wyoming');


//Adding a foreign key on "state" column in representatives_of_hr_active table
    //as referring to state_codes.twoLetterCode
ALTER TABLE representatives_of_hr_active
ADD CONSTRAINT fk_links_state_to_state_codes
FOREIGN KEY (state)
REFERENCES state_codes(twoLetterCode);

//Adding a foreign key on "party" column in representatives_of_hr_active table
    //as referring to party_codes.partyCode
ALTER TABLE representatives_of_hr_active
ADD CONSTRAINT fk_links_party_to_party_codes
FOREIGN KEY (party)
REFERENCES party_codes(partyCode);

//Delete the deprecated congressional_legislators_active table
DROP TABLE IF EXISTS congressional_legislators_active;